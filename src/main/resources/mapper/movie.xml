<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="com.kosta.mapper.MovieMapper">
	
	<select id="getmovielist" resultType="com.kosta.dto.KobisDTO" parameterType="String">
		select movieCd, movieNm, plotText, genreNm, repNationNm, openDt, watchGradeNm, showTm, poster
		from movie_info
		where movieNm like CONCAT('%',#{keyword},'%')
		
	</select>
	<select id="getmoviedetail" resultType="com.kosta.dto.KobisDTO" parameterType="String">
		select movieCd, movieNm, plotText, genreNm, repNationNm, openDt, watchGradeNm, showTm, poster
		from movie_info
		where movieCd=#{movieCd}
	</select>
	
	<select id="getmoviedailyrank" resultType="com.kosta.dto.KobisDTO">
		select rank, movieCd
		from movie_dailyrank
	</select>
	
	<insert id="insertmovie" parameterType="java.util.List">
		replace into movie_info(
			movieCd
			, movieNm
			, plotText
			, genreNm
			, repNationNm
			, openDt
			, watchGradeNm
			, showTm
			, poster
			, keywords
		)
		values
		<foreach collection="list" item="item" separator=" , " >
	        (#{item.movieCd}, #{item.movieNm}, #{item.plotText}, #{item.repGenreNm}, #{item.repNationNm}
			, #{item.openDt}, #{item.watchGradeNm}, #{item.showTm}, #{item.poster}, #{item.keywords})
   		 </foreach>
		
		
	</insert>
  
  	<insert id="insertrank" parameterType="java.util.List">
		replace into movie_dailyrank(
			rank,
			movieCd
		)
		values
		<foreach collection="list" item="item" separator=" , " >
	        (#{item.rank}, #{item.movieCd})
   		 </foreach>
		
		
	</insert>
  	<select id="getrandomlist" resultType="com.kosta.dto.KobisDTO">
		select movieCd, movieNm, plotText, genreNm, repNationNm, openDt, watchGradeNm, showTm, poster
		from movie_info
		where poster!="" and openDt!="" and plotText!="" and genreNm!="성인물(에로)"
		order by rand() limit 10
		
	</select>
  
  
  
  
  
  
  
  
  
  
  
  
  </mapper>
